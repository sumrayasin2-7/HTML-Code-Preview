<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart HTML Code Preview</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --gold-primary: #D4AF37;
            --gold-secondary: #FFD700;
            --gold-light: #F5E6B3;
            --gold-dark: #B8860B;
            --bg-dark: #1A1A1A;
            --bg-darker: #0F0F0F;
            --text-light: #F5F5F5;
            --text-dark: #333333;
            --panel-bg: #2D2D2D;
            --panel-border: #444444;
            --success: #10B981;
            --error: #EF4444;
            --separate-btn: #3B82F6;
            --theme-toggle: #8B5CF6;
            --border-radius: 10px;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
            --header-height: 80px;
            --sidebar-width: 300px;
        }

        .light-mode {
            --gold-primary: #B8860B;
            --gold-secondary: #D4AF37;
            --gold-light: #5C4A00;
            --gold-dark: #8B6B00;
            --bg-dark: #F5F5F5;
            --bg-darker: #E0E0E0;
            --text-light: #333333;
            --text-dark: #000000;
            --panel-bg: #FFFFFF;
            --panel-border: #DDDDDD;
            --success: #0D9C6B;
            --error: #D32F2F;
            --separate-btn: #1D4ED8;
            --theme-toggle: #7C3AED;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-darker) 0%, var(--bg-dark) 100%);
            color: var(--text-light);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            transition: var(--transition);
        }

        .golden-accent {
            background: linear-gradient(90deg, var(--gold-dark), var(--gold-primary), var(--gold-secondary));
            height: 4px;
            width: 100%;
            margin-bottom: 20px;
            border-radius: 2px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        header {
            background: rgba(42, 42, 42, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-primary), transparent);
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.8rem;
            text-align: center;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--gold-light), var(--gold-secondary), var(--gold-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        .light-mode h1 {
            color: #f5d000;
            background: none;
            -webkit-text-fill-color: unset;
            -webkit-background-clip: unset;
            text-shadow: 0 0 10px rgba(245, 208, 0, 0.3);
        }

        .subtitle {
            text-align: center;
            color: var(--gold-light);
            font-size: 1.1rem;
            margin-bottom: 20px;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .light-mode .subtitle {
            color: #f5d000;
            font-weight: 600;
        }

        /* Updated Toolbar Layout for Desktop */
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 12px;
            padding: 15px 0;
            position: relative;
        }

        .toolbar-left {
            display: flex;
            gap: 12px;
            flex: 1;
            justify-content: flex-start;
        }

        .toolbar-center {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex: 1;
        }

        .toolbar-right {
            display: flex;
            gap: 12px;
            flex: 1;
            justify-content: flex-end;
        }

        .toolbar-bottom {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 10px;
        }

        button {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary));
            color: var(--text-dark);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
            z-index: -1;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        #reset-btn {
            background: linear-gradient(135deg, #7a1c1c, var(--error));
            color: white;
        }

        #separate-code-btn {
            background: linear-gradient(135deg, var(--separate-btn), #60A5FA);
            color: white;
        }

        #theme-toggle {
            background: linear-gradient(135deg, var(--theme-toggle), #A78BFA);
            color: white;
        }

        #history-toggle {
            background: linear-gradient(135deg, #059669, #10B981);
            color: white;
        }

        #download-pdf-btn {
            background: linear-gradient(135deg, #DC2626, #EF4444);
            color: white;
        }

        #download-btn {
            background: linear-gradient(135deg, #0f7a5c, var(--success));
            color: white;
        }

        #run-btn {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary));
            color: var(--text-dark);
        }

        #code-save-btn {
            background: linear-gradient(135deg, #059669, #10B981);
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 25px;
            height: 75vh;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .toolbar-left,
            .toolbar-center,
            .toolbar-right {
                justify-content: center;
                flex: none;
                width: 100%;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .toolbar-left,
            .toolbar-center,
            .toolbar-right {
                flex-direction: column;
                width: 100%;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }

        .editors-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            max-height: 100%;
        }

        .editor-panel {
            display: flex;
            flex-direction: column;
            flex: 1;
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(212, 175, 55, 0.2);
            min-height: 200px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, rgba(42, 42, 42, 0.9), rgba(52, 52, 52, 0.9));
            color: var(--gold-light);
            padding: 12px 20px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }

        .light-mode .editor-header {
            background: linear-gradient(90deg, rgba(230, 230, 230, 0.9), rgba(210, 210, 210, 0.9));
            color: var(--gold-dark);
        }

        textarea {
            width: 100%;
            flex: 1;
            padding: 20px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            border: none;
            resize: none;
            background: var(--panel-bg);
            color: var(--text-light);
            line-height: 1.6;
            tab-size: 4;
            -moz-tab-size: 4;
            white-space: pre;
            overflow-wrap: normal;
            overflow-x: auto;
            transition: var(--transition);
            border-left: 3px solid var(--gold-primary);
            min-height: 250px;
        }

        textarea:focus {
            outline: none;
            background: var(--bg-dark);
            border-left: 3px solid var(--gold-secondary);
        }

        .light-mode textarea:focus {
            background: var(--bg-darker);
        }

        .preview-panel {
            display: flex;
            flex-direction: column;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            background: var(--panel-bg);
            height: 100%;
            transition: var(--transition);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, rgba(42, 42, 42, 0.9), rgba(52, 52, 52, 0.9));
            color: var(--gold-light);
            padding: 12px 20px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }

        .light-mode .preview-header {
            background: linear-gradient(90deg, rgba(230, 230, 230, 0.9), rgba(210, 210, 210, 0.9));
            color: var(--gold-dark);
        }

        #preview {
            flex: 1;
            border: none;
            width: 100%;
            height: 100%;
            background-color: white;
            min-height: 500px;
        }

        .error-message {
            background-color: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--error);
            padding: 12px;
            color: var(--error);
            display: none;
            margin: 10px;
            border-radius: 4px;
        }

        footer {
            text-align: center;
            padding: 25px 0;
            margin-top: 20px;
            color: var(--gold-light);
            font-size: 0.9rem;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
        }

        .combined-editor {
            min-height: 300px;
        }

        .tabs {
            display: flex;
            margin-bottom: 15px;
            background-color: var(--panel-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(212, 175, 55, 0.2);
            gap: 4px;
        }

        .tab-btn {
            padding: 15px 25px;
            background-color: var(--panel-bg);
            color: var(--text-light);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            flex: 1;
            text-align: center;
            position: relative;
            margin: 2px;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary));
            color: var(--text-dark);
        }

        .tab-btn:not(.active):hover {
            background: rgba(212, 175, 55, 0.1);
            color: var(--gold-light);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .icon {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary));
            color: var(--text-dark);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: transform 0.4s ease;
            z-index: 1000;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 4px solid var(--gold-secondary);
            font-size: 0.9rem;
            max-width: 300px;
            text-align: center;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-darker);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary));
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
        }

        .golden-frame {
            position: relative;
            padding: 2px;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary), var(--gold-secondary), var(--gold-primary), var(--gold-dark));
            background-size: 400% 400%;
            animation: gradientShift 5s ease infinite;
        }

        .golden-frame > div {
            border-radius: calc(var(--border-radius) - 2px);
            overflow: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            background: rgba(42, 42, 42, 0.9);
            color: var(--gold-light);
            font-size: 0.8rem;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
        }

        .light-mode .status-bar {
            background: rgba(230, 230, 230, 0.9);
            color: var(--gold-dark);
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .gold-highlight {
            color: var(--gold-secondary);
            font-weight: 600;
        }

        .light-mode .gold-highlight {
            color: var(--gold-primary);
        }

        #fullscreen-btn {
            padding: 6px 12px;
            font-size: 0.8rem;
            background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary));
        }

        .preview-container {
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .preview-zoom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            display: flex;
            gap: 5px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px;
            border-radius: 5px;
        }
        
        .preview-zoom-controls button {
            padding: 5px 10px;
            font-size: 0.8rem;
            background: var(--gold-primary);
            color: var(--text-dark);
            min-width: 50px;
        }
        
        .preview-zoom-controls button:hover {
            transform: none;
        }
        
        #zoom-reset {
            min-width: 60px;
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: var(--panel-bg);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            border-left: 2px solid var(--gold-primary);
            transform: translateX(100%);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(90deg, rgba(42, 42, 42, 0.9), rgba(52, 52, 52, 0.9));
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .light-mode .sidebar-header {
            background: linear-gradient(90deg, rgba(230, 230, 230, 0.9), rgba(210, 210, 210, 0.9));
        }

        .sidebar-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .history-item {
            background: var(--bg-dark);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--gold-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .history-item:hover {
            transform: translateX(5px);
            background: var(--bg-darker);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-item-title {
            font-weight: 600;
            color: var(--gold-light);
            font-size: 1.1rem;
        }

        .history-item-date {
            font-size: 0.8rem;
            color: var(--gold-light);
            opacity: 0.7;
        }

        .history-item-preview {
            font-size: 0.9rem;
            color: var(--text-light);
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 10px;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .no-history {
            text-align: center;
            padding: 40px 20px;
            color: var(--gold-light);
            opacity: 0.7;
        }

        .history-count {
            background: var(--gold-primary);
            color: var(--text-dark);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            margin-left: 5px;
        }

        .mobile-preview {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            overflow: auto;
        }

        .mobile-preview.active {
            display: block;
        }

        .mobile-preview-content {
            width: 100%;
            height: 100%;
            border: none;
        }

        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .history-modal.active {
            display: flex;
        }

        .history-modal-content {
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow);
            border: 2px solid var(--gold-primary);
        }

        .history-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 15px;
        }

        .history-modal-title {
            font-size: 1.5rem;
            color: var(--gold-light);
            font-weight: 600;
        }

        .history-modal-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: center;
            margin-top: 25px;
        }

        .history-modal-actions button {
            padding: 10px 20px;
            min-width: 120px;
        }

        #history-edit-btn {
            background: linear-gradient(135deg, var(--separate-btn), #60A5FA);
            color: white;
        }

        #history-preview-btn {
            background: linear-gradient(135deg, var(--success), #34D399);
            color: white;
        }

        #history-download-zip-btn {
            background: linear-gradient(135deg, #0f7a5c, var(--success));
            color: white;
        }

        #history-download-pdf-btn {
            background: linear-gradient(135deg, #DC2626, #EF4444);
            color: white;
        }

        #history-delete-btn {
            background: linear-gradient(135deg, #7a1c1c, var(--error));
            color: white;
        }

        #history-close-modal {
            background: transparent;
            color: var(--gold-light);
            border: 1px solid var(--gold-light);
        }

        #history-close-modal:hover {
            background: var(--gold-light);
            color: var(--text-dark);
        }

        @media (max-width: 768px) {
            .preview-zoom-controls {
                display: none;
            }
            
            .history-modal-content {
                padding: 20px;
            }
            
            .history-modal-actions {
                flex-direction: column;
            }
            
            .history-modal-actions button {
                width: 100%;
            }
        }

        .history-modal-header {
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 15px;
        }

        .history-modal-title {
            font-size: 1.5rem;
            color: var(--gold-light);
            font-weight: 600;
            width: 100%;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    
    <div class="sidebar" id="history-sidebar">
        <div class="sidebar-header">
            <h3>Code Preview History</h3>
            <button id="close-sidebar">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
        </div>
        <div class="sidebar-content">
            <div id="history-list">
                <!-- History items will be added here dynamically -->
            </div>
        </div>
    </div>

    <!-- History Item Modal -->
    <div class="history-modal" id="history-modal">
        <div class="history-modal-content">
            <div class="history-modal-header">
                <h3 class="history-modal-title" id="history-modal-title">Code History</h3>
                <button id="history-close-modal">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="history-modal-body">
                <p id="history-modal-description">Select an action for this code history item.</p>
            </div>
            <div class="history-modal-actions">
                <button id="history-edit-btn">Edit Code</button>
                <button id="history-preview-btn">Preview Code</button>
                <button id="history-download-zip-btn">Download ZIP</button>
                <button id="history-download-pdf-btn">Download PDF</button>
                <button id="history-delete-btn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Mobile Preview Overlay -->
    <div class="mobile-preview" id="mobile-preview">
        <iframe class="mobile-preview-content" id="mobile-preview-frame"></iframe>
    </div>

    <div class="container">
        <header>
            <h1 id="main-title">Smart HTML Code Preview</h1>
            <p class="subtitle">Professional Code Editing & Preview Environment</p>
            <div class="golden-accent"></div>
            
            <!-- Updated Toolbar Structure -->
            <div class="toolbar">
                <div class="toolbar-left">
                    <button id="theme-toggle">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM6.34 5.16l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.42-1.42c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0zm13.08 12.42l1.42 1.42c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.42-1.42c-.39-.39-1.02-.39-1.41 0a.9959.9959 0 0 0 0 1.41zM5.16 17.66l1.42-1.42c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0zm12.42-13.08l-1.42-1.42c-.39-.39-1.02-.39-1.41 0a.9959.9959 0 0 0 0 1.41l1.42 1.42c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41z"/>
                        </svg>
                        Dark Mode
                    </button>
                    <button id="separate-code-btn">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M10 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h5v2c0 .55.45 1 1 1s1-.45 1-1v-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-5v1c0 .55-.45 1-1 1s-1-.45-1-1V3zm0 15H5l5-6v6zm0-9l-5 6h5V9zm4-3h5l-5 6V6zm0 9h5V9h-5v6z"/>
                        </svg>
                        Separate Code
                    </button>
                </div>

                <div class="toolbar-center">
                    <button id="download-btn">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                        Download ZIP
                    </button>
                    <button id="download-pdf-btn">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/>
                        </svg>
                        Download PDF
                    </button>
                    <button id="history-toggle">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                        </svg>
                        History <span id="history-count" class="history-count">0</span>
                    </button>
                </div>

                <div class="toolbar-right">
                    <button id="reset-btn">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                        </svg>
                        Reset Code
                    </button>
                    <button id="code-save-btn">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                        </svg>
                        Save Code
                    </button>
                </div>

                <div class="toolbar-bottom">
                    <button id="run-btn">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        Run Code
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="editors-container">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="combined">Combined Code</button>
                    <button class="tab-btn" data-tab="separate">Separate Code</button>
                </div>

                <div id="combined-tab" class="tab-content active">
                    <div class="golden-frame">
                        <div class="editor-panel">
                            <div class="editor-header">
                                <div class="editor-title">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M14 1H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 15H4V4h10v12zm6-5v9c0 1.1.9 2 2 2h2v-2h-2v-9h-2zm-12 5H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/>
                                    </svg>
                                    <span>Combined Code (HTML + CSS + JS)</span>
                                </div>
                                <button class="copy-editor-btn" data-editor="combined">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                                    </svg>
                                    Copy
                                </button>
                            </div>
                            <textarea id="combined-code" class="combined-editor" placeholder="Enter your combined HTML, CSS, and JavaScript code here..."></textarea>
                            <div class="status-bar">
                                <div class="status-info">
                                    <span>Lines: <span id="combined-lines" class="gold-highlight">0</span></span>
                                    <span>Language: HTML</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="separate-tab" class="tab-content">
                    <div class="golden-frame">
                        <div class="editor-panel">
                            <div class="editor-header">
                                <div class="editor-title">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M14.17 5L19 9.83V19H5V5h9.17m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9.83c0-.53-.21-1.04-.59-1.41l-4.83-4.83c-.37-.38-.88-.59-1.41-.59zM7 15h10v2H7v-2zm0-4h10v2H7v-2zm0-4h7v2H7V7z"/>
                                    </svg>
                                    <span>HTML</span>
                                </div>
                                <button class="copy-editor-btn" data-editor="html">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                                    </svg>
                                    Copy
                                </button>
                            </div>
                            <textarea id="html-code" placeholder="Enter HTML code here..."></textarea>
                            <div class="status-bar">
                                <span>Lines: <span id="html-lines" class="gold-highlight">0</span></span>
                                <span>Language: HTML</span>
                            </div>
                        </div>
                    </div>

                    <div class="golden-frame">
                        <div class="editor-panel">
                            <div class="editor-header">
                                <div class="editor-title">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M10 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h5v2c0 .55.45 1 1 1s1-.45 1-1v-2h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-5v1c0 .55-.45 1-1 1s-1-.45-1-1V3zm0 15H5l5-6v6zm0-9l-5 6h5V9zm4-3h5l-5 6V6zm0 9h5V9h-5v6z"/>
                                    </svg>
                                    <span>CSS</span>
                                </div>
                                <button class="copy-editor-btn" data-editor="css">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                                    </svg>
                                    Copy
                                </button>
                            </div>
                            <textarea id="css-code" placeholder="Enter CSS code here..."></textarea>
                            <div class="status-bar">
                                <span>Lines: <span id="css-lines" class="gold-highlight">0</span></span>
                                <span>Language: CSS</span>
                            </div>
                        </div>
                    </div>

                    <div class="golden-frame">
                        <div class="editor-panel">
                            <div class="editor-header">
                                <div class="editor-title">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M14 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h9c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h9v14zm4-12h2v10h-2V7z"/>
                                    </svg>
                                    <span>JavaScript</span>
                                </div>
                                <button class="copy-editor-btn" data-editor="js">
                                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                                    </svg>
                                    Copy
                                </button>
                            </div>
                            <textarea id="js-code" placeholder="Enter JavaScript code here..."></textarea>
                            <div class="status-bar">
                                <span>Lines: <span id="js-lines" class="gold-highlight">0</span></span>
                                <span>Language: JavaScript</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="golden-frame">
                <div class="preview-panel">
                    <div class="preview-header">
                        <div class="editor-title">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"/>
                            </svg>
                            <span>Live Preview</span>
                        </div>
                        <button id="fullscreen-btn">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                            </svg>
                            Full Screen
                        </button>
                    </div>
                    <div class="preview-container">
                        <div class="preview-zoom-controls">
                            <button id="zoom-out">-</button>
                            <button id="zoom-reset">100%</button>
                            <button id="zoom-in">+</button>
                        </div>
                        <iframe id="preview"></iframe>
                    </div>
                    <div id="error-message" class="error-message"></div>
                    <div class="status-bar">
                        <div class="status-info">
                            <span>Preview Status: <span id="preview-status" class="gold-highlight">Ready</span></span>
                            <span>Last Updated: <span id="last-updated" class="gold-highlight">Just now</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>Smart HTML Code Preview Tool © 2025 | Professional Code Editing Environment<br>Yasin H. Sumra</p>
        </footer>
    </div>

    <div class="notification" id="notification">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        Code copied to clipboard!
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const htmlCode = document.getElementById('html-code');
            const cssCode = document.getElementById('css-code');
            const jsCode = document.getElementById('js-code');
            const combinedCode = document.getElementById('combined-code');
            const preview = document.getElementById('preview');
            const runBtn = document.getElementById('run-btn');
            const resetBtn = document.getElementById('reset-btn');
            const downloadBtn = document.getElementById('download-btn');
            const downloadPdfBtn = document.getElementById('download-pdf-btn');
            const themeToggle = document.getElementById('theme-toggle');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const separateCodeBtn = document.getElementById('separate-code-btn');
            const errorMessage = document.getElementById('error-message');
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const copyEditorBtns = document.querySelectorAll('.copy-editor-btn');
            const notification = document.getElementById('notification');
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            const zoomResetBtn = document.getElementById('zoom-reset');
            const historyToggle = document.getElementById('history-toggle');
            const closeSidebar = document.getElementById('close-sidebar');
            const sidebar = document.getElementById('history-sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const historyList = document.getElementById('history-list');
            const historyCount = document.getElementById('history-count');
            const mobilePreview = document.getElementById('mobile-preview');
            const mobilePreviewFrame = document.getElementById('mobile-preview-frame');
            const codeSaveBtn = document.getElementById('code-save-btn');
            
            // History modal elements
            const historyModal = document.getElementById('history-modal');
            const historyModalTitle = document.getElementById('history-modal-title');
            const historyModalDescription = document.getElementById('history-modal-description');
            const historyEditBtn = document.getElementById('history-edit-btn');
            const historyPreviewBtn = document.getElementById('history-preview-btn');
            const historyDownloadZipBtn = document.getElementById('history-download-zip-btn');
            const historyDownloadPdfBtn = document.getElementById('history-download-pdf-btn');
            const historyDeleteBtn = document.getElementById('history-delete-btn');
            const historyCloseModal = document.getElementById('history-close-modal');
            
            // Status elements
            const htmlLines = document.getElementById('html-lines');
            const cssLines = document.getElementById('css-lines');
            const jsLines = document.getElementById('js-lines');
            const combinedLines = document.getElementById('combined-lines');
            const previewStatus = document.getElementById('preview-status');
            const lastUpdated = document.getElementById('last-updated');

            // Preview zoom state
            let previewZoom = 100;
            
            // Current selected history item
            let currentHistoryItem = null;

            // Default code examples - COMPLETELY EMPTY
            const defaultHTML = '';
            const defaultCSS = '';
            const defaultJS = '';
            const defaultCombined = '';

            // History management
            let codeHistory = JSON.parse(localStorage.getItem('codeHistory')) || [];

            function saveHistory() {
                localStorage.setItem('codeHistory', JSON.stringify(codeHistory));
                updateHistoryDisplay();
            }

            function addToHistory(name, html, css, js) {
                const timestamp = new Date();
                const dateString = timestamp.toLocaleDateString();
                const previewText = html.substring(0, 100) + '...';
                
                // Extract title from combined code
                let title = "Untitled Code";
                if (combinedCode.value.trim() !== "") {
                    // Try to extract title from HTML title tag or use first line
                    const titleMatch = combinedCode.value.match(/<title[^>]*>([^<]+)<\/title>/i);
                    if (titleMatch && titleMatch[1]) {
                        title = titleMatch[1].trim();
                    } else {
                        // Use first non-empty line as title
                        const lines = combinedCode.value.split('\n');
                        for (let line of lines) {
                            if (line.trim() !== "") {
                                title = line.trim().substring(0, 30);
                                break;
                            }
                        }
                    }
                }
                
                const historyItem = {
                    id: Date.now(),
                    name: name,
                    title: title,
                    timestamp: timestamp.getTime(),
                    dateString: dateString,
                    html: html,
                    css: css,
                    js: js,
                    preview: previewText
                };
                
                codeHistory.unshift(historyItem);
                
                // Keep only the last 20 items
                if (codeHistory.length > 20) {
                    codeHistory = codeHistory.slice(0, 20);
                }
                
                saveHistory();
                return historyItem;
            }

            function updateHistoryDisplay() {
                historyList.innerHTML = '';
                historyCount.textContent = codeHistory.length;
                
                if (codeHistory.length === 0) {
                    historyList.innerHTML = '<div class="no-history">No code history yet. Save your first project!</div>';
                    return;
                }
                
                codeHistory.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div class="history-item-header">
                            <div class="history-item-title">${item.title}</div>
                        </div>
                        <div class="history-item-date">${item.dateString}</div>
                        <div class="history-item-preview">${item.preview}</div>
                    `;
                    
                    // Add click event to show modal
                    historyItem.addEventListener('click', function() {
                        showHistoryModal(item);
                    });
                    
                    historyList.appendChild(historyItem);
                });
            }

            function showHistoryModal(item) {
                currentHistoryItem = item;
                historyModalTitle.textContent = item.title;
                historyModalDescription.textContent = `Created: ${item.dateString}`;
                historyModal.classList.add('active');
            }

            function closeHistoryModal() {
                historyModal.classList.remove('active');
                currentHistoryItem = null;
            }

            function loadHistoryItem(id) {
                const item = codeHistory.find(i => i.id === id);
                if (item) {
                    htmlCode.value = item.html;
                    cssCode.value = item.css;
                    jsCode.value = item.js;
                    updateCombinedCode();
                    saveCode();
                    updatePreview();
                    showNotification('Code loaded from history!');
                }
            }

            function deleteHistoryItem(id) {
                if (confirm('Are you sure you want to delete this history item?')) {
                    codeHistory = codeHistory.filter(i => i.id !== id);
                    saveHistory();
                    showNotification('History item deleted!');
                }
            }

            function openSidebar() {
                sidebar.classList.add('open');
                sidebarOverlay.classList.add('active');
            }

            function closeSidebarFunc() {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('active');
            }

            // Sidebar event listeners
            historyToggle.addEventListener('click', openSidebar);
            closeSidebar.addEventListener('click', closeSidebarFunc);
            sidebarOverlay.addEventListener('click', closeSidebarFunc);

            // History modal event listeners
            historyCloseModal.addEventListener('click', closeHistoryModal);
            historyEditBtn.addEventListener('click', function() {
                if (currentHistoryItem) {
                    loadHistoryItem(currentHistoryItem.id);
                    closeHistoryModal();
                    closeSidebarFunc();
                }
            });
            
            historyPreviewBtn.addEventListener('click', function() {
                if (currentHistoryItem) {
                    // Create a temporary preview
                    const previewDocument = `<!DOCTYPE html>
<html>
<head>
    <title>${currentHistoryItem.title}</title>
    <style>${currentHistoryItem.css}</style>
</head>
<body>
    ${currentHistoryItem.html}
    <script>${currentHistoryItem.js}<\/script>
</body>
</html>`;
                    
                    // Open in new tab for preview
                    const newWindow = window.open();
                    newWindow.document.write(previewDocument);
                    newWindow.document.close();
                    
                    closeHistoryModal();
                }
            });
            
            historyDownloadZipBtn.addEventListener('click', function() {
                if (currentHistoryItem) {
                    const zip = new JSZip();
                    
                    // Get the current date for the filename
                    const date = new Date();
                    const dateString = `${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2, '0')}${date.getDate().toString().padStart(2, '0')}_${date.getHours().toString().padStart(2, '0')}${date.getMinutes().toString().padStart(2, '0')}`;
                    
                    // Add HTML file
                    const htmlContent = `<!DOCTYPE html>
<html>
<head>
    <title>${currentHistoryItem.title}</title>
    <style>${currentHistoryItem.css}</style>
</head>
<body>
    ${currentHistoryItem.html}
    <script>${currentHistoryItem.js}<\/script>
</body>
</html>`;
                    
                    zip.file("index.html", htmlContent);
                    
                    // Generate the ZIP file
                    zip.generateAsync({type:"blob"})
                    .then(function(content) {
                        // Save the ZIP file
                        saveAs(content, `code-project-${dateString}.zip`);
                        showNotification('Project downloaded as ZIP file!');
                    });
                    
                    closeHistoryModal();
                }
            });
            
            historyDownloadPdfBtn.addEventListener('click', function() {
                if (currentHistoryItem) {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Set font and initial position
                    doc.setFont('helvetica');
                    doc.setFontSize(12);
                    
                    let yPosition = 20;
                    const lineHeight = 7;
                    const pageHeight = doc.internal.pageSize.height;
                    const margin = 20;
                    
                    // Function to add text with page break
                    function addText(text, isHeader = false) {
                        if (isHeader) {
                            doc.setFontSize(16);
                            doc.setFont(undefined, 'bold');
                        } else {
                            doc.setFontSize(10);
                            doc.setFont(undefined, 'normal');
                        }
                        
                        // Check if we need a new page
                        if (yPosition > pageHeight - margin) {
                            doc.addPage();
                            yPosition = margin;
                        }
                        
                        const lines = doc.splitTextToSize(text, 170);
                        doc.text(lines, margin, yPosition);
                        yPosition += lines.length * lineHeight;
                    }
                    
                    // Add header
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text('Code Preview Export', margin, 15);
                    
                    // Add timestamp
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Generated on: ${new Date().toLocaleString()}`, margin, 25);
                    yPosition = 35;
                    
                    // Add HTML section
                    addText('HTML CODE', true);
                    addText(currentHistoryItem.html);
                    
                    yPosition += lineHeight;
                    
                    // Add CSS section
                    addText('CSS CODE', true);
                    addText(currentHistoryItem.css);
                    
                    yPosition += lineHeight;
                    
                    // Add JavaScript section
                    addText('JAVASCRIPT CODE', true);
                    addText(currentHistoryItem.js);
                    
                    // Save the PDF
                    doc.save('code-preview-export.pdf');
                    showNotification('PDF downloaded successfully!');
                    
                    closeHistoryModal();
                }
            });
            
            historyDeleteBtn.addEventListener('click', function() {
                if (currentHistoryItem) {
                    if (confirm('Are you sure you want to delete this history item?')) {
                        codeHistory = codeHistory.filter(i => i.id !== currentHistoryItem.id);
                        saveHistory();
                        closeHistoryModal();
                        closeSidebarFunc();
                        showNotification('History item deleted!');
                    }
                }
            });

            // Code Save button event listener
            codeSaveBtn.addEventListener('click', function() {
                if (combinedCode.value.trim() === '') {
                    showNotification('No code to save! Please add code to the combined code box.');
                    return;
                }
                
                const projectName = prompt('Enter a name for this project:', `Project ${codeHistory.length + 1}`);
                if (projectName) {
                    addToHistory(projectName, htmlCode.value, cssCode.value, jsCode.value);
                    showNotification('Code saved to history!');
                }
            });

            // Theme functionality
            function initTheme() {
                const savedTheme = localStorage.getItem('theme') || 'dark';
                if (savedTheme === 'light') {
                    document.body.classList.add('light-mode');
                    themeToggle.innerHTML = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.37 5.51c-.18.64-.27 1.31-.27 1.99 0 4.08 3.32 7.4 7.4 7.4.68 0 1.35-.09 1.99-.27C17.45 17.19 14.93 19 12 19c-3.86 0-7-3.14-7-7 0-2.93 1.81-5.45 4.37-6.49zM12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>Light Mode';
                } else {
                    document.body.classList.remove('light-mode');
                    themeToggle.innerHTML = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM6.34 5.16l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.42-1.42c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0zm13.08 12.42l1.42 1.42c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.42-1.42c-.39-.39-1.02-.39-1.41 0a.9959.9959 0 0 0 0 1.41zM5.16 17.66l1.42-1.42c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0zm12.42-13.08l-1.42-1.42c-.39-.39-1.02-.39-1.41 0a.9959.9959 0 0 0 0 1.41l1.42 1.42c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41z"/></svg>Dark Mode';
                }
            }

            themeToggle.addEventListener('click', () => {
                if (document.body.classList.contains('light-mode')) {
                    document.body.classList.remove('light-mode');
                    localStorage.setItem('theme', 'dark');
                    themeToggle.innerHTML = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM6.34 5.16l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l1.42-1.42c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0zm13.08 12.42l1.42 1.42c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.42-1.42c-.39-.39-1.02-.39-1.41 0a.9959.9959 0 0 0 0 1.41zM5.16 17.66l1.42-1.42c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0l-1.42 1.42c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0zm12.42-13.08l-1.42-1.42c-.39-.39-1.02-.39-1.41 0a.9959.9959 0 0 0 0 1.41l1.42 1.42c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41z"/></svg>Dark Mode';
                } else {
                    document.body.classList.add('light-mode');
                    localStorage.setItem('theme', 'light');
                    themeToggle.innerHTML = '<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.37 5.51c-.18.64-.27 1.31-.27 1.99 0 4.08 3.32 7.4 7.4 7.4.68 0 1.35-.09 1.99-.27C17.45 17.19 14.93 19 12 19c-3.86 0-7-3.14-7-7 0-2.93 1.81-5.45 4.37-6.49zM12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>Light Mode';
                }
            });

            // Preview zoom functionality
            function updatePreviewZoom() {
                preview.style.transform = `scale(${previewZoom / 100})`;
                preview.style.transformOrigin = 'top left';
                zoomResetBtn.textContent = `${previewZoom}%`;
            }

            zoomInBtn.addEventListener('click', () => {
                if (previewZoom < 200) {
                    previewZoom += 10;
                    updatePreviewZoom();
                }
            });

            zoomOutBtn.addEventListener('click', () => {
                if (previewZoom > 50) {
                    previewZoom -= 10;
                    updatePreviewZoom();
                }
            });

            zoomResetBtn.addEventListener('click', () => {
                previewZoom = 100;
                updatePreviewZoom();
            });

            // Mobile preview functionality
            function openMobilePreview() {
                mobilePreview.classList.add('active');
                // Update mobile preview with current code
                const previewDocument = generateCombinedCode();
                const mobilePreviewDoc = mobilePreviewFrame.contentDocument || mobilePreviewFrame.contentWindow.document;
                mobilePreviewDoc.open();
                mobilePreviewDoc.write(previewDocument);
                mobilePreviewDoc.close();
            }

            function closeMobilePreviewFunc() {
                mobilePreview.classList.remove('active');
            }

            // UPDATED: Fullscreen functionality - Now properly shows the preview
            fullscreenBtn.addEventListener('click', function() {
                // Generate the preview document from current code
                const previewDocument = generateCombinedCode();
                
                // Create a new window with the preview
                const newWindow = window.open('', '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
                
                // Write the complete HTML document to the new window
                newWindow.document.write(previewDocument);
                newWindow.document.close();
                
                // Focus the new window
                newWindow.focus();
            });

            // Separate Code functionality
            separateCodeBtn.addEventListener('click', function() {
                const combinedText = combinedCode.value;
                
                if (!combinedText.trim()) {
                    showNotification('Combined code box is empty!');
                    return;
                }
                
                // Extract HTML content (between <body> tags or entire content if no body tag)
                let htmlContent = '';
                let cssContent = '';
                let jsContent = '';
                
                // Try to extract content between <body> tags
                const bodyMatch = combinedText.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
                if (bodyMatch) {
                    htmlContent = bodyMatch[1].trim();
                } else {
                    // If no body tags, try to extract content after the last style/script tag
                    htmlContent = combinedText;
                }
                
                // Extract CSS content (between <style> tags)
                const styleMatch = combinedText.match(/<style[^>]*>([\s\S]*?)<\/style>/i);
                if (styleMatch) {
                    cssContent = styleMatch[1].trim();
                }
                
                // Extract JavaScript content (between <script> tags)
                const scriptMatch = combinedText.match(/<script[^>]*>([\s\S]*?)<\/script>/i);
                if (scriptMatch) {
                    jsContent = scriptMatch[1].trim();
                }
                
                // Update the separate code editors
                htmlCode.value = htmlContent || '<!-- No HTML content found -->';
                cssCode.value = cssContent || '/* No CSS content found */';
                jsCode.value = jsContent || '// No JavaScript content found';
                
                // Switch to separate code tab
                tabBtns.forEach(b => b.classList.remove('active'));
                document.querySelector('.tab-btn[data-tab="separate"]').classList.add('active');
                
                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById('separate-tab').classList.add('active');
                
                // Update line counts and save
                updateLineCounts();
                saveCode();
                
                showNotification('Code separated successfully!');
            });

            // Tab functionality
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    
                    // Update active tab button
                    tabBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Show active tab content
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // If switching to combined tab, update combined code
                    if (tabId === 'combined') {
                        updateCombinedCode();
                    }
                });
            });

            // Update line counts
            function updateLineCounts() {
                htmlLines.textContent = htmlCode.value.split('\n').length;
                cssLines.textContent = cssCode.value.split('\n').length;
                jsLines.textContent = jsCode.value.split('\n').length;
                combinedLines.textContent = combinedCode.value.split('\n').length;
            }

            // Load saved code from localStorage or set defaults
            function loadCode() {
                htmlCode.value = localStorage.getItem('htmlCode') || defaultHTML;
                cssCode.value = localStorage.getItem('cssCode') || defaultCSS;
                jsCode.value = localStorage.getItem('jsCode') || defaultJS;
                combinedCode.value = localStorage.getItem('combinedCode') || defaultCombined;
                updatePreview();
                updateLineCounts();
            }

            // Save code to localStorage
            function saveCode() {
                localStorage.setItem('htmlCode', htmlCode.value);
                localStorage.setItem('cssCode', cssCode.value);
                localStorage.setItem('jsCode', jsCode.value);
                localStorage.setItem('combinedCode', combinedCode.value);
                updateLineCounts();
            }

            // Generate combined code from separate editors
            function generateCombinedCode() {
                return `<!DOCTYPE html>
<html>
<head>
    <title>Code Preview</title>
    <style>${cssCode.value}</style>
</head>
<body>
    ${htmlCode.value}
    <script>${jsCode.value}<\/script>
</body>
</html>`;
            }

            // Update combined code editor
            function updateCombinedCode() {
                combinedCode.value = generateCombinedCode();
                updateLineCounts();
            }

            // Update preview iframe
            function updatePreview() {
                const html = htmlCode.value;
                const css = cssCode.value;
                const js = jsCode.value;
                const combined = combinedCode.value;

                // Determine which code to use based on active tab
                const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
                const previewDocument = activeTab === 'combined' ? combined : generateCombinedCode();

                // Update iframe
                const previewDoc = preview.contentDocument || preview.contentWindow.document;
                previewDoc.open();
                previewDoc.write(previewDocument);
                previewDoc.close();

                // Update status - ONLY DATE, NO TIME
                previewStatus.textContent = 'Loaded Successfully';
                lastUpdated.textContent = new Date().toLocaleDateString();
                
                // Hide error message
                errorMessage.style.display = 'none';
            }

            // Show notification
            function showNotification(message) {
                notification.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }

            // Listen for errors from the iframe
            window.addEventListener('message', function(event) {
                if (event.data.type === 'ERROR') {
                    errorMessage.textContent = event.data.message;
                    errorMessage.style.display = 'block';
                    previewStatus.textContent = 'Error in Code';
                }
            });

            // Run code button - UPDATED: Runs code without saving to history
            runBtn.addEventListener('click', function() {
                // Save current code to localStorage (for persistence)
                saveCode();
                
                // If separate tab is active, update combined code
                if (document.querySelector('.tab-btn.active').dataset.tab === 'separate') {
                    updateCombinedCode();
                    saveCode();
                }
                
                updatePreview();
                previewStatus.textContent = 'Running...';
                setTimeout(() => {
                    previewStatus.textContent = 'Executed Successfully';
                }, 500);
            });

            // UPDATED: Reset button - Now completely clears ALL code boxes and prevents default template from appearing
            resetBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to reset all code? All content will be cleared.')) {
                    // Reset all code editors to COMPLETELY EMPTY
                    htmlCode.value = '';
                    cssCode.value = '';
                    jsCode.value = '';
                    combinedCode.value = '';
                    
                    saveCode();
                    updatePreview();
                    showNotification('All code has been reset');
                }
            });

            // Download code as ZIP button
            downloadBtn.addEventListener('click', function() {
                const zip = new JSZip();
                
                // Get the current date for the filename
                const date = new Date();
                const dateString = `${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2, '0')}${date.getDate().toString().padStart(2, '0')}_${date.getHours().toString().padStart(2, '0')}${date.getMinutes().toString().padStart(2, '0')}`;
                
                // Add HTML file
                let htmlContent;
                if (document.querySelector('.tab-btn.active').dataset.tab === 'separate') {
                    // For separate files, create an HTML that links to external CSS and JS
                    htmlContent = `<!DOCTYPE html>
<html>
<head>
    <title>My Project</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    ${htmlCode.value}
    <script src="script.js"><\/script>
</body>
</html>`;
                } else {
                    // For combined, use the combined code
                    htmlContent = combinedCode.value;
                }
                
                zip.file("index.html", htmlContent);
                
                // Add CSS file (if in separate mode)
                if (document.querySelector('.tab-btn.active').dataset.tab === 'separate') {
                    zip.file("styles.css", cssCode.value);
                }
                
                // Add JS file (if in separate mode)
                if (document.querySelector('.tab-btn.active').dataset.tab === 'separate') {
                    zip.file("script.js", jsCode.value);
                }
                
                // Generate the ZIP file
                zip.generateAsync({type:"blob"})
                .then(function(content) {
                    // Save the ZIP file
                    saveAs(content, `code-project-${dateString}.zip`);
                    showNotification('Project downloaded as ZIP file!');
                });
            });

            // Download PDF functionality
            downloadPdfBtn.addEventListener('click', function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Set font and initial position
                doc.setFont('helvetica');
                doc.setFontSize(12);
                
                let yPosition = 20;
                const lineHeight = 7;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;
                
                // Function to add text with page break
                function addText(text, isHeader = false) {
                    if (isHeader) {
                        doc.setFontSize(16);
                        doc.setFont(undefined, 'bold');
                    } else {
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                    }
                    
                    // Check if we need a new page
                    if (yPosition > pageHeight - margin) {
                        doc.addPage();
                        yPosition = margin;
                    }
                    
                    const lines = doc.splitTextToSize(text, 170);
                    doc.text(lines, margin, yPosition);
                    yPosition += lines.length * lineHeight;
                }
                
                // Add header
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Code Preview Export', margin, 15);
                
                // Add timestamp
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Generated on: ${new Date().toLocaleString()}`, margin, 25);
                yPosition = 35;
                
                // Add HTML section
                addText('HTML CODE', true);
                addText(htmlCode.value);
                
                yPosition += lineHeight;
                
                // Add CSS section
                addText('CSS CODE', true);
                addText(cssCode.value);
                
                yPosition += lineHeight;
                
                // Add JavaScript section
                addText('JAVASCRIPT CODE', true);
                addText(jsCode.value);
                
                // Save the PDF
                doc.save('code-preview-export.pdf');
                showNotification('PDF downloaded successfully!');
            });

            // Copy individual editor code buttons
            copyEditorBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const editorType = this.dataset.editor;
                    let codeToCopy;
                    
                    switch(editorType) {
                        case 'html':
                            codeToCopy = htmlCode.value;
                            break;
                        case 'css':
                            codeToCopy = cssCode.value;
                            break;
                        case 'js':
                            codeToCopy = jsCode.value;
                            break;
                        case 'combined':
                            codeToCopy = combinedCode.value;
                            break;
                    }
                    
                    navigator.clipboard.writeText(codeToCopy)
                        .then(() => {
                            showNotification(`${editorType.toUpperCase()} code copied to clipboard!`);
                        })
                        .catch(err => {
                            console.error('Failed to copy: ', err);
                        });
                });
            });

            // Auto-resize textareas
            function autoResize(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = (textarea.scrollHeight) + 'px';
            }

            [htmlCode, cssCode, jsCode, combinedCode].forEach(textarea => {
                textarea.addEventListener('input', function() {
                    autoResize(this);
                    saveCode();
                    
                    // If editing separate code, update combined code if combined tab is active
                    if (textarea !== combinedCode && document.querySelector('.tab-btn.active').dataset.tab === 'combined') {
                        updateCombinedCode();
                    }
                });
                
                // Initial resize
                autoResize(textarea);
            });

            // Initialize
            initTheme();
            loadCode();
            updatePreviewZoom();
            updateHistoryDisplay();
        });
    </script>
</body>
</html>